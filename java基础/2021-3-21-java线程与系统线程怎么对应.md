# Java 线程和操作系统的线程是怎么对应的？Java线程是怎样进行调度的?


## 内核线程
* 内核线程就是内核的分身，一个分身可以处理一件特定事情。这在处理异步事件如异步IO时特别有用。内核线程的使用是廉价的，唯一使用的资源就是内核栈和上下文切换时保存寄存器的空间。支持多线程的内核叫做多线程内核(Multi-Threads kernel )。
* 内核线程只运行在内核态，不受用户态上下文的拖累。
* 处理器竞争：可以在全系统范围内竞争处理器资源；
* 使用资源：唯一使用的资源是内核栈和上下文切换时保持寄存器的空间
* 调度：调度的开销可能和进程自身差不多昂贵
* 同步效率：资源的同步和数据共享比整个进程的数据同步和共享要低一些。

    
    
## 轻量级进程
* 轻量级进程(LWP)是建立在内核之上并由内核支持的用户线程，它是内核线程的高度抽象，每一个轻量级进程都与一个特定的内核线程关联。内核线程只能由内核管理并像普通进程一样被调度。
* 轻量级进程由clone()系统调用创建，参数是CLONE_VM，即与父进程是共享进程地址空间和系统资源。
* 与普通进程区别：LWP只有一个最小的执行上下文和调度程序所需的统计信息。
* 处理器竞争：因与特定内核线程关联，因此可以在全系统范围内竞争处理器资源
* 使用资源：与父进程共享进程地址空间
* 调度：像普通进程一样调度
    
    
## 用户线程
* 用户线程是完全建立在用户空间的线程库，用户线程的创建、调度、同步和销毁全又库函数在用户空间完成，不需要内核的帮助。因此这种线程是极其低消耗和高效的。
* 处理器竞争：单纯的用户线程是建立在用户空间，其对内核是透明的，因此其所属进程单独参与处理器的竞争，而进程的所有线程参与竞争该进程的资源。
* 使用资源：与所属进程共享进程地址空间和系统资源。
* 调度：由在用户空间实现的线程库，在所属进程内进行调度
    
    
## 加强版的用户线程——用户线程+LWP
* 这种模型对应着恐龙书中多对多模型。
* 用户线程库还是完全建立在用户空间中，因此用户线程的操作还是很廉价，因此可以建立任意多需要的用户线程。
* 操作系统提供了LWP作为用户线程和内核线程之间的桥梁。LWP还是和前面提到的一样，具有内核线程支持，是内核的调度单元，并且用户线程的系统调用要通过LWP，因此进程中某个用户线程的阻塞不会影响整个进程的执行。
* 用户线程库将建立的用户线程关联到LWP上，LWP与用户线程的数量不一定一致。当内核调度到某个LWP上时，此时与该LWP关联的用户线程就被执行
    
    
# java线程与lwp轻量级进程

  Java里的线程是由JVM来管理的，它如何对应到操作系统的线程是由JVM的实现来确定的。Linux 2.6上的HotSpot使用了NPTL机制，JVM线程跟内核轻量级进程有一一对应的关系。
  
  
# java线程如何调度

  是直接由操作系统内核支持的——由内核完成线程切换，内核通过操纵调度器（Thread Scheduler）实现线程调度，并将线程任务反映到各个处理器上。

    
    
