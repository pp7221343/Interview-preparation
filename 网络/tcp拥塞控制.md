# 拥塞控制算法

  * tcp的拥塞控制算法主要有：
  
    * 慢开始
    * 拥塞控制
    * 快重传
    * 快恢复

* 涉及到的变量

  * 发送窗口（swnd）
  * 拥塞窗口（cwnd）
  * 慢开始门限（ssthresh）
  * 单位：定为数据包方便计算
  * 传播轮次：发送方发送一个数据包，并且接受方回复ack以后经过的时间，RRT，称为一个传播轮次


## 慢开始
  * 慢开始是指一开始向网络中发送的数据包少
## 拥塞控制
  * 在拥塞避免阶段，将拥塞窗口控制为线性增长
## 快重传
  * 在丢失个别数据包时快速重传，不依赖超时重传
## 快恢复
  * 将拥塞窗口 和慢开始门限降低一半


  * 1.在tcp建立连接以后，拥塞窗口初始为1，此时发送窗口也为1（swnd = cwnd）
  * 2.在收到接收方的ack确认以后，将拥塞窗口+1，同时发送窗口也+1 （swnd = cwnd + ack数）
  * 3.在未到达慢开始门限，并且没有发生丢包的情况下，持续，直到发送窗口和拥塞窗口大于等于慢开始门限（swnd == cwnd） 并且 >= ssthresh
  * **以上为慢开始流程**
  * 4.执行拥塞控制，实现方式为每次收到一个窗口大小的数据包时（假设此时窗口= 16，慢开始门限 = 16），收到 16个ack确认之后，拥塞窗口大小+1，即为17
  * **以上是拥塞控制**
  * 5.如果发生丢包情况，例如此时发生丢包，一个窗口24个数据包，发送了20个，丢包了4个，接收方会依次回复20个确认ack，
  *   一段时间后，丢失的4个报文段的重传计时器超时了，发送发判断可能出现拥塞，更改cwnd和ssthresh.并重新开始慢开始算法
  *   
  *   此时如果按照现有流程，会将发送窗口和拥塞窗口设置为1，重新启动慢开始
  *   
  * 6.如果只丢是了个别报文，例如发送了一个窗口发送了1.2.3.4,5,6 六个报文，
  *   接收方回复 1ack，2ack，第三个丢失了，剩下的数据包会接着发，但是接收方会回复2ack，即报文2的确认，后续 4，5，6会给发送方连续发三个2ack确认，
  *   此时发送方判断个别数据包丢失，针对丢失数据包个别重传（发送3号报文）
  *   接收方此时会回复此时已经收到的最新的报文确认ack（6ack）
  *   **快重传：收到三个连续的重复确认ack，就将相应的报文立即重传**

  * 7.发送方在收到三个连续重复确认ack以后，执行**快恢复算法**，
  *   发送方将发送窗口，拥塞窗口，以及慢开始门限设置为当前的一半，执行拥塞控制
  *   cwnd = cwnd/2 ssthresh = sshthresh/2  或者  ssthresh = sshthresh/2 + 3（加上离开网络的数据包）


